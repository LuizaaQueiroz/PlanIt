{% extends 'sidebar.html' %}

{% block conteudo %}

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@3.2.0/dist/fullcalendar.min.css" rel="stylesheet" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendarStyle.css') }}">

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@3.2.0/dist/fullcalendar.min.js"></script>

<!-- Botão para abrir o modal -->
<button id="addEventBtn" onclick="openAddEventModal()">Adicionar Evento</button>

<div class="wrapper">
    <div id="calendar"></div>
</div>

<!-- Modal para Adicionar Evento -->
<div id="addEventModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeAddEventModal()">&times;</span>
        <form id="addEventForm">
            <input type="text" id="eventTitle" placeholder="Título do Evento" required>
            <textarea id="eventDescription" placeholder="Descrição do Evento" required></textarea>
            <input type="datetime-local" id="eventStart" required>
            <input type="datetime-local" id="eventEnd" required>
            <button type="submit">Salvar Evento</button>
        </form>
    </div>
</div>

<script>
    // Função para abrir o modal
    function openAddEventModal() {
        document.getElementById("addEventModal").style.display = "block";
    }

    // Função para fechar o modal
    function closeAddEventModal() {
        document.getElementById("addEventModal").style.display = "none";
    }

    $(document).ready(function() {
        // Inicializar o calendário
        $('#calendar').fullCalendar({
            events: {{ events | tojson }},
            eventClick: function(event) {
                alert('Evento: ' + event.title + '\n' + event.description);
            },
            editable: true,
        });

        // Manipulação do formulário para adicionar evento
        $('#addEventForm').submit(function(event) {
            event.preventDefault();

            const title = $('#eventTitle').val();
            const description = $('#eventDescription').val();
            const start = $('#eventStart').val();
            const end = $('#eventEnd').val();

            // Adicionar evento ao FullCalendar
            $('#calendar').fullCalendar('renderEvent', {
                title: title,
                description: description,
                start: start,
                end: end,
                allDay: false
            }, true); // true para persistir no calendário

            // Fechar o modal
            closeAddEventModal();
        });
    });
</script>

{% endblock conteudo %}
